<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="theme-color" content="#09090b">
  <title>Transformation Ahmed 2025</title>
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&family=Outfit:wght@800;900&display=swap" rel="stylesheet">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: 'DM Sans', sans-serif; background: #09090b; color: #fafafa; -webkit-font-smoothing: antialiased; overflow-x: hidden; }
    button { cursor: pointer; font-family: inherit; border: none; -webkit-tap-highlight-color: transparent; }
    input, textarea, select { font-family: inherit; }
    ::-webkit-scrollbar { width: 8px; }
    ::-webkit-scrollbar-track { background: #18181b; }
    ::-webkit-scrollbar-thumb { background: #3f3f46; border-radius: 4px; }
    canvas { max-height: 300px !important; }
  </style>
</head>
<body>
  <div id="root"></div>

  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  
  <script type="text/babel">
    const { useState, useEffect, useRef } = React;

    const App = () => {
      const [currentView, setCurrentView] = useState('today');
      const [data, setData] = useState({});
      const [selectedDate, setSelectedDate] = useState(new Date().toISOString().split('T')[0]);
      const [expandedSections, setExpandedSections] = useState({ morning: false, evening: false, meal: false });
      const [weekOffset, setWeekOffset] = useState(0);
      const [monthOffset, setMonthOffset] = useState(0);
      const [progressMetric, setProgressMetric] = useState('weight');
      const chartRef = useRef(null);
      const chartInstance = useRef(null);
      
      useEffect(() => {
        const saved = localStorage.getItem('transformation-ahmed-data');
        if (saved) {
          try { setData(JSON.parse(saved)); } catch (e) { console.error(e); }
        }
      }, []);

      useEffect(() => {
        if (Object.keys(data).length > 0) {
          localStorage.setItem('transformation-ahmed-data', JSON.stringify(data));
        }
      }, [data]);

      useEffect(() => {
        if (currentView === 'progress' && chartRef.current) {
          if (chartInstance.current) {
            chartInstance.current.destroy();
          }
          
          const progressData = getProgressData();
          if (progressData.length > 0) {
            const ctx = chartRef.current.getContext('2d');
            
            const isBarChart = progressMetric === 'training' || progressMetric === 'fasting';
            const chartColor = progressMetric === 'weight' ? '#10b981' : 
                              progressMetric === 'steps' ? '#3b82f6' :
                              progressMetric === 'training' ? '#f43f5e' : '#a855f7';
            
            chartInstance.current = new Chart(ctx, {
              type: isBarChart ? 'bar' : 'line',
              data: {
                labels: progressData.map(d => d.date),
                datasets: [{
                  label: progressMetric === 'weight' ? 'Poids (kg)' :
                         progressMetric === 'steps' ? 'Pas' :
                         progressMetric === 'training' ? 'S√©ances' : 'Jours',
                  data: progressData.map(d => d.value),
                  backgroundColor: isBarChart ? chartColor : 'transparent',
                  borderColor: chartColor,
                  borderWidth: 3,
                  tension: 0.4,
                  fill: !isBarChart,
                  pointRadius: isBarChart ? 0 : 6,
                  pointBackgroundColor: chartColor
                }]
              },
              options: {
                responsive: true,
                maintainAspectRatio: true,
                plugins: {
                  legend: { display: false },
                  tooltip: {
                    backgroundColor: '#18181b',
                    titleColor: '#fafafa',
                    bodyColor: '#fafafa',
                    borderColor: '#27272a',
                    borderWidth: 1,
                    padding: 12,
                    displayColors: false
                  }
                },
                scales: {
                  y: {
                    beginAtZero: progressMetric !== 'weight',
                    ticks: { color: '#71717a', font: { size: 12 } },
                    grid: { color: '#27272a' }
                  },
                  x: {
                    ticks: { color: '#71717a', font: { size: 12 }, maxRotation: 45, minRotation: 45 },
                    grid: { display: false }
                  }
                }
              }
            });
          }
        }
        
        return () => {
          if (chartInstance.current) {
            chartInstance.current.destroy();
            chartInstance.current = null;
          }
        };
      }, [currentView, progressMetric, data]);

      const getTodayData = () => {
        return data[selectedDate] || {
          supplements: { morning: {}, evening: {}, meal: {} },
          training: null,
          steps: '',
          hydration: false,
          weight: '',
          fasting: null,
          comments: '',
          mood: []
        };
      };

      const updateData = (field, value) => {
        setData(prev => ({
          ...prev,
          [selectedDate]: { ...getTodayData(), [field]: value }
        }));
      };

      const toggleSupplement = (time, supp) => {
        const today = getTodayData();
        const supplements = { ...today.supplements };
        supplements[time] = { ...supplements[time] };
        supplements[time][supp] = !supplements[time][supp];
        updateData('supplements', supplements);
      };

      const toggleAllSupplements = (time) => {
        const today = getTodayData();
        const supplements = { ...today.supplements };
        const list = supplementsList[time];
        const allChecked = list.every(s => supplements[time]?.[s]);
        supplements[time] = {};
        list.forEach(s => { supplements[time][s] = !allChecked; });
        updateData('supplements', supplements);
      };

      const toggleMood = (emoji) => {
        const today = getTodayData();
        const moods = [...(today.mood || [])];
        const idx = moods.indexOf(emoji);
        if (idx > -1) moods.splice(idx, 1);
        else moods.push(emoji);
        updateData('mood', moods);
      };

      const getDayStatus = (date) => {
        const dayData = data[date];
        if (!dayData) return 'empty';
        
        const checks = [
          ...Object.values(dayData.supplements?.morning || {}),
          ...Object.values(dayData.supplements?.evening || {}),
          ...Object.values(dayData.supplements?.meal || {}),
          !!dayData.training, dayData.hydration, !!dayData.fasting
        ];
        const completed = checks.filter(Boolean).length;
        const total = checks.length;
        
        if (completed === total) return 'complete';
        if (completed > total * 0.6) return 'partial';
        return 'incomplete';
      };

      const getWeekDates = () => {
        const dates = [];
        const today = new Date();
        const startOfWeek = new Date(today);
        startOfWeek.setDate(today.getDate() - today.getDay() + 1 + (weekOffset * 7));
        
        for (let i = 0; i < 7; i++) {
          const date = new Date(startOfWeek);
          date.setDate(startOfWeek.getDate() + i);
          dates.push(date.toISOString().split('T')[0]);
        }
        return dates;
      };

      const getMonthDates = () => {
        const dates = [];
        const today = new Date();
        const targetMonth = new Date(today.getFullYear(), today.getMonth() + monthOffset, 1);
        
        const firstDay = targetMonth.getDay();
        const offset = firstDay === 0 ? -6 : 1 - firstDay;
        
        const startDate = new Date(targetMonth);
        startDate.setDate(offset);
        
        for (let i = 0; i < 35; i++) {
          const date = new Date(startDate);
          date.setDate(startDate.getDate() + i);
          dates.push(date.toISOString().split('T')[0]);
        }
        
        return dates;
      };

      const getProgressData = () => {
        const sorted = Object.entries(data)
          .filter(([_, value]) => {
            if (progressMetric === 'weight') return value.weight && value.weight !== '';
            if (progressMetric === 'steps') return value.steps && value.steps !== '';
            if (progressMetric === 'training') return value.training;
            if (progressMetric === 'fasting') return value.fasting;
            return false;
          })
          .sort(([a], [b]) => new Date(a) - new Date(b));

        if (progressMetric === 'weight') {
          return sorted.map(([date, value]) => ({
            date: new Date(date).toLocaleDateString('fr-FR', { day: '2-digit', month: 'short' }),
            value: parseFloat(value.weight)
          }));
        }
        
        if (progressMetric === 'steps') {
          return sorted.map(([date, value]) => ({
            date: new Date(date).toLocaleDateString('fr-FR', { day: '2-digit', month: 'short' }),
            value: parseInt(value.steps)
          }));
        }

        if (progressMetric === 'training') {
          const counts = {};
          sorted.forEach(([date]) => {
            const weekKey = new Date(date).toLocaleDateString('fr-FR', { day: '2-digit', month: 'short' });
            counts[weekKey] = (counts[weekKey] || 0) + 1;
          });
          return Object.entries(counts).slice(-10).map(([date, count]) => ({ date, value: count }));
        }

        if (progressMetric === 'fasting') {
          const types = {};
          sorted.forEach(([_, value]) => {
            types[value.fasting] = (types[value.fasting] || 0) + 1;
          });
          return Object.entries(types).map(([type, count]) => ({ date: type, value: count }));
        }

        return [];
      };

      const exportData = () => {
        const csv = ['Date,Poids,Training,Pas,Hydratation,Je√ªne,Mood,Suppl Matin,Suppl Soir,Suppl Repas,Commentaires'];
        Object.entries(data).forEach(([date, value]) => {
          const morning = Object.entries(value.supplements?.morning || {}).filter(([_, c]) => c).map(([s]) => s).join(';');
          const evening = Object.entries(value.supplements?.evening || {}).filter(([_, c]) => c).map(([s]) => s).join(';');
          const meal = Object.entries(value.supplements?.meal || {}).filter(([_, c]) => c).map(([s]) => s).join(';');
          csv.push([date, value.weight || '', value.training || '', value.steps || '', value.hydration ? 'Oui' : 'Non', 
                    value.fasting || '', (value.mood || []).join(';'), morning, evening, meal, 
                    (value.comments || '').replace(/,/g, ';')].join(','));
        });
        const blob = new Blob([csv.join('\n')], { type: 'text/csv' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `transformation-ahmed-${new Date().toISOString().split('T')[0]}.csv`;
        a.click();
      };

      const getStreak = () => {
        let streak = 0;
        const today = new Date();
        for (let i = 0; i < 100; i++) {
          const date = new Date(today);
          date.setDate(date.getDate() - i);
          const dateStr = date.toISOString().split('T')[0];
          if (getDayStatus(dateStr) === 'complete') streak++;
          else if (i > 0) break;
        }
        return streak;
      };

      const supplementsList = {
        morning: ['NAC 1200mg', 'Vitamine C 1000mg', 'Magn√©sium 200mg', '√âlectrolytes 500ml'],
        evening: ['NAC 1200mg', 'Vitamine C 500mg', '√âlectrolytes 500ml'],
        meal: ['Cr√©atine 5g', 'Magn√©sium 200mg', 'Zinc 30mg']
      };

      const trainings = ['S√©ance A (Squat/Pouss√©e)', 'S√©ance B (Deadlift/Traction)', 'S√©ance C (Mixte)'];
      const fastingTypes = ['16/8', 'OMAD', 'OMAD Sec', 'Je√ªne Total 24h', 'Je√ªne Sec Total'];
      const moods = [
        { emoji: 'üòä', label: 'Tr√®s bien' },
        { emoji: 'üí™', label: 'Fort' },
        { emoji: 'üò¥', label: 'Fatigu√©' },
        { emoji: 'ü§ï', label: 'Mal de t√™te' },
        { emoji: 'üò∞', label: 'Faible' },
        { emoji: 'ü•µ', label: 'Chaud' }
      ];

      const today = getTodayData();
      const isMonday = new Date(selectedDate).getDay() === 1;
      const streak = getStreak();
      const weekDates = getWeekDates();
      const monthDates = getMonthDates();
      const progressData = getProgressData();

      const styles = {
        container: { minHeight: '100vh', paddingBottom: '80px' },
        header: { background: 'linear-gradient(to bottom right, #18181b, #09090b)', borderBottom: '1px solid #27272a', padding: '24px 16px', position: 'sticky', top: 0, zIndex: 10 },
        maxW: { maxWidth: '896px', margin: '0 auto' },
        title: { fontSize: '36px', fontWeight: '900', color: '#10b981', fontFamily: 'Outfit, sans-serif' },
        subtitle: { color: '#71717a', fontSize: '14px', marginTop: '4px' },
        nav: { display: 'flex', gap: '8px', marginTop: '16px', overflowX: 'auto', paddingBottom: '8px' },
        navBtn: (active) => ({
          padding: '8px 16px', borderRadius: '8px', fontSize: '14px', fontWeight: '600',
          background: active ? '#10b981' : '#27272a', color: active ? '#09090b' : '#a1a1aa',
          whiteSpace: 'nowrap', transition: 'all 0.2s'
        }),
        content: { maxWidth: '896px', margin: '0 auto', padding: '24px 16px' },
        card: { background: '#18181b', borderRadius: '12px', padding: '24px', border: '1px solid #27272a', marginBottom: '16px' },
        cardHeader: { display: 'flex', alignItems: 'center', justifyContent: 'space-between', marginBottom: '16px' },
        cardTitle: (color) => ({ fontSize: '20px', fontWeight: 'bold', color }),
        btn: (active) => ({
          width: '100%', textAlign: 'left', padding: '12px 16px', borderRadius: '8px', marginBottom: '8px',
          background: active ? 'rgba(16, 185, 129, 0.1)' : '#27272a',
          border: `2px solid ${active ? '#10b981' : '#3f3f46'}`,
          color: active ? '#10b981' : '#a1a1aa', display: 'flex', alignItems: 'center', gap: '12px'
        }),
        input: { width: '100%', background: '#27272a', border: '2px solid #3f3f46', borderRadius: '8px', 
                padding: '16px', fontSize: '20px', fontWeight: 'bold', textAlign: 'center', color: '#fafafa' },
        textarea: { width: '100%', background: '#27272a', border: '2px solid #3f3f46', borderRadius: '8px',
                   padding: '12px', color: '#fafafa', resize: 'none', fontFamily: 'inherit' },
        select: { width: '100%', background: '#27272a', border: '2px solid #3f3f46', borderRadius: '8px',
                 padding: '12px 16px', fontSize: '16px', fontWeight: '600', color: '#fafafa' }
      };

      const SupplementSection = ({ time, title, color, icon }) => {
        const today = getTodayData();
        const list = supplementsList[time];
        const count = Object.values(today.supplements[time] || {}).filter(Boolean).length;
        const expanded = expandedSections[time];

        return (
          <div style={styles.card}>
            <div style={{ cursor: 'pointer' }} onClick={() => setExpandedSections(p => ({ ...p, [time]: !p[time] }))}>
              <div style={styles.cardHeader}>
                <div>
                  <h2 style={styles.cardTitle(color)}>{icon} {title}</h2>
                  <p style={{ fontSize: '12px', color: '#71717a', marginTop: '4px' }}>{count}/{list.length} pris</p>
                </div>
                <div style={{ display: 'flex', gap: '12px', alignItems: 'center' }}>
                  <button onClick={(e) => { e.stopPropagation(); toggleAllSupplements(time); }}
                    style={{ padding: '6px 12px', borderRadius: '6px', fontSize: '12px', fontWeight: '600',
                            background: list.every(s => today.supplements[time]?.[s]) ? '#10b981' : '#3f3f46',
                            color: list.every(s => today.supplements[time]?.[s]) ? '#09090b' : '#fafafa' }}>
                    Tout
                  </button>
                  <span style={{ fontSize: '20px' }}>{expanded ? '‚ñ≤' : '‚ñº'}</span>
                </div>
              </div>
            </div>
            {expanded && list.map(supp => (
              <button key={supp} onClick={() => toggleSupplement(time, supp)} style={styles.btn(today.supplements[time]?.[supp])}>
                <span style={{ fontSize: '20px' }}>{today.supplements[time]?.[supp] ? '‚úì' : '‚óã'}</span>
                <span>{supp}</span>
              </button>
            ))}
          </div>
        );
      };

      return (
        <div style={styles.container}>
          <div style={styles.header}>
            <div style={styles.maxW}>
              <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
                <div>
                  <h1 style={styles.title}>TRANSFORMATION</h1>
                  <p style={styles.subtitle}>130kg ‚Üí 90kg ¬∑ Phase 1</p>
                </div>
                {streak > 0 && (
                  <div style={{ textAlign: 'right' }}>
                    <div style={{ display: 'flex', alignItems: 'center', gap: '8px', color: '#fb923c' }}>
                      <span style={{ fontSize: '20px' }}>üî•</span>
                      <span style={{ fontSize: '24px', fontWeight: 'bold' }}>{streak}</span>
                    </div>
                    <p style={{ fontSize: '12px', color: '#71717a' }}>jours</p>
                  </div>
                )}
              </div>
              <div style={styles.nav}>
                {['today', 'week', 'month', 'progress', 'history'].map(view => (
                  <button key={view} onClick={() => setCurrentView(view)} style={styles.navBtn(currentView === view)}>
                    {view === 'today' && "Aujourd'hui"}
                    {view === 'week' && 'Semaine'}
                    {view === 'month' && 'Mois'}
                    {view === 'progress' && 'Progression'}
                    {view === 'history' && 'Historique'}
                  </button>
                ))}
              </div>
            </div>
          </div>

          <div style={styles.content}>
            {currentView === 'today' && (
              <>
                <div style={{ ...styles.card, textAlign: 'center' }}>
                  <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
                    <button onClick={() => { const d = new Date(selectedDate); d.setDate(d.getDate() - 1); setSelectedDate(d.toISOString().split('T')[0]); }}
                      style={{ padding: '8px', background: 'transparent', color: '#fafafa', fontSize: '20px' }}>‚Üê</button>
                    <div>
                      <p style={{ fontSize: '24px', fontWeight: 'bold' }}>
                        {new Date(selectedDate).toLocaleDateString('fr-FR', { weekday: 'long', day: 'numeric', month: 'long' })}
                      </p>
                      {selectedDate === new Date().toISOString().split('T')[0] && (
                        <p style={{ fontSize: '12px', color: '#10b981', marginTop: '4px' }}>Aujourd'hui</p>
                      )}
                    </div>
                    <button onClick={() => { const d = new Date(selectedDate); d.setDate(d.getDate() + 1); if (d <= new Date()) setSelectedDate(d.toISOString().split('T')[0]); }}
                      disabled={selectedDate >= new Date().toISOString().split('T')[0]}
                      style={{ padding: '8px', background: 'transparent', color: '#fafafa', fontSize: '20px', opacity: selectedDate >= new Date().toISOString().split('T')[0] ? 0.3 : 1 }}>‚Üí</button>
                  </div>
                </div>

                <SupplementSection time="morning" title="Compl√©ments Matin (7h15)" color="#fbbf24" icon="üíä" />
                <SupplementSection time="evening" title="Compl√©ments Soir (18h)" color="#818cf8" icon="üíä" />
                <SupplementSection time="meal" title="Avec Repas (18h-19h)" color="#a78bfa" icon="üíä" />

                <div style={styles.card}>
                  <h2 style={styles.cardTitle('#f43f5e')}>üí™ Training Salle</h2>
                  {trainings.map(t => (
                    <button key={t} onClick={() => updateData('training', today.training === t ? null : t)}
                      style={{ ...styles.btn(today.training === t), marginTop: '8px' }}>{t}</button>
                  ))}
                </div>

                <div style={styles.card}>
                  <h2 style={styles.cardTitle('#3b82f6')}>üë£ Nombre de pas</h2>
                  <input type="number" value={today.steps} onChange={(e) => updateData('steps', e.target.value)}
                    placeholder="10000" style={{ ...styles.input, marginTop: '16px' }} />
                </div>

                <div style={styles.card}>
                  <h2 style={styles.cardTitle('#a855f7')}>‚è∞ Type de Je√ªne</h2>
                  {fastingTypes.map(f => (
                    <button key={f} onClick={() => updateData('fasting', today.fasting === f ? null : f)}
                      style={{ ...styles.btn(today.fasting === f), marginTop: '8px' }}>{f}</button>
                  ))}
                </div>

                <div style={styles.card}>
                  <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
                    <div>
                      <h2 style={styles.cardTitle('#06b6d4')}>üíß Hydratation 3-4L</h2>
                      <p style={{ fontSize: '14px', color: '#71717a', marginTop: '4px' }}>√âlectrolytes toute la journ√©e</p>
                    </div>
                    <button onClick={() => updateData('hydration', !today.hydration)}
                      style={{ width: '64px', height: '64px', borderRadius: '50%', background: today.hydration ? '#06b6d4' : '#27272a',
                              color: today.hydration ? '#09090b' : '#71717a', fontSize: '32px' }}>
                      {today.hydration ? '‚úì' : '‚óã'}
                    </button>
                  </div>
                </div>

                {isMonday && (
                  <div style={styles.card}>
                    <h2 style={styles.cardTitle('#10b981')}>‚öñÔ∏è Poids du Lundi</h2>
                    <input type="number" step="0.1" value={today.weight} onChange={(e) => updateData('weight', e.target.value)}
                      placeholder="130.0" style={{ ...styles.input, marginTop: '16px', fontSize: '32px' }} />
                    <p style={{ textAlign: 'center', color: '#71717a', fontSize: '14px', marginTop: '8px' }}>kg ¬∑ √Ä jeun le matin</p>
                  </div>
                )}

                <div style={styles.card}>
                  <h2 style={{ fontSize: '20px', fontWeight: 'bold', marginBottom: '16px' }}>Comment tu te sens ?</h2>
                  <div style={{ display: 'grid', gridTemplateColumns: 'repeat(3, 1fr)', gap: '12px' }}>
                    {moods.map(({ emoji, label }) => (
                      <button key={emoji} onClick={() => toggleMood(emoji)}
                        style={{ padding: '16px', borderRadius: '12px', background: today.mood?.includes(emoji) ? 'rgba(251, 146, 60, 0.1)' : '#27272a',
                                border: `2px solid ${today.mood?.includes(emoji) ? '#fb923c' : '#3f3f46'}`, textAlign: 'center' }}>
                        <div style={{ fontSize: '40px', marginBottom: '8px' }}>{emoji}</div>
                        <div style={{ fontSize: '12px', color: '#a1a1aa' }}>{label}</div>
                      </button>
                    ))}
                  </div>
                </div>

                <div style={styles.card}>
                  <h2 style={{ fontSize: '20px', fontWeight: 'bold', marginBottom: '16px' }}>üìù Notes & Commentaires</h2>
                  <textarea value={today.comments} onChange={(e) => updateData('comments', e.target.value)}
                    placeholder="Remarques, ressentis, observations du jour..." rows="4" style={styles.textarea} />
                </div>
              </>
            )}

            {currentView === 'week' && (
              <>
                <div style={{ ...styles.card, display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
                  <button onClick={() => setWeekOffset(weekOffset - 1)}
                    style={{ padding: '8px', background: 'transparent', color: '#fafafa', fontSize: '20px' }}>‚Üê</button>
                  <p style={{ fontSize: '20px', fontWeight: 'bold' }}>
                    Semaine du {new Date(weekDates[0]).toLocaleDateString('fr-FR', { day: 'numeric', month: 'long' })}
                  </p>
                  <button onClick={() => setWeekOffset(weekOffset + 1)} disabled={weekOffset >= 0}
                    style={{ padding: '8px', background: 'transparent', color: '#fafafa', fontSize: '20px', opacity: weekOffset >= 0 ? 0.3 : 1 }}>‚Üí</button>
                </div>

                <div style={{ display: 'grid', gridTemplateColumns: 'repeat(7, 1fr)', gap: '8px', marginBottom: '16px' }}>
                  {weekDates.map(date => {
                    const status = getDayStatus(date);
                    const dayData = data[date];
                    const dayName = new Date(date).toLocaleDateString('fr-FR', { weekday: 'short' });
                    const dayNum = new Date(date).getDate();
                    const statusColors = {
                      complete: { bg: 'rgba(16, 185, 129, 0.1)', border: '#10b981' },
                      partial: { bg: 'rgba(251, 146, 60, 0.1)', border: '#fb923c' },
                      incomplete: { bg: 'rgba(244, 63, 94, 0.1)', border: '#f43f5e' },
                      empty: { bg: '#18181b', border: '#27272a' }
                    };

                    return (
                      <button key={date} onClick={() => { setSelectedDate(date); setCurrentView('today'); }}
                        style={{
                          aspectRatio: '1', borderRadius: '12px', padding: '12px', border: `2px solid ${statusColors[status].border}`,
                          background: statusColors[status].bg, textAlign: 'center'
                        }}>
                        <div style={{ fontSize: '10px', color: '#71717a', textTransform: 'uppercase', marginBottom: '4px' }}>{dayName}</div>
                        <div style={{ fontSize: '24px', fontWeight: 'bold', marginBottom: '4px' }}>{dayNum}</div>
                        {dayData?.weight && <div style={{ fontSize: '10px', color: '#a1a1aa' }}>{dayData.weight}kg</div>}
                      </button>
                    );
                  })}
                </div>

                <div style={styles.card}>
                  <h3 style={{ fontWeight: 'bold', marginBottom: '16px' }}>L√©gende</h3>
                  <div style={{ display: 'flex', flexDirection: 'column', gap: '12px', fontSize: '14px' }}>
                    <div style={{ display: 'flex', alignItems: 'center', gap: '12px' }}>
                      <div style={{ width: '24px', height: '24px', borderRadius: '4px', background: 'rgba(16, 185, 129, 0.1)', border: '2px solid #10b981' }}></div>
                      <span>Vert : Tout fait ‚úì</span>
                    </div>
                    <div style={{ display: 'flex', alignItems: 'center', gap: '12px' }}>
                      <div style={{ width: '24px', height: '24px', borderRadius: '4px', background: 'rgba(251, 146, 60, 0.1)', border: '2px solid #fb923c' }}></div>
                      <span>Orange : Partiel (&gt;60%)</span>
                    </div>
                    <div style={{ display: 'flex', alignItems: 'center', gap: '12px' }}>
                      <div style={{ width: '24px', height: '24px', borderRadius: '4px', background: 'rgba(244, 63, 94, 0.1)', border: '2px solid #f43f5e' }}></div>
                      <span>Rouge : Peu fait</span>
                    </div>
                    <div style={{ display: 'flex', alignItems: 'center', gap: '12px' }}>
                      <div style={{ width: '24px', height: '24px', borderRadius: '4px', background: '#18181b', border: '2px solid #27272a' }}></div>
                      <span>Gris : Pas de donn√©es</span>
                    </div>
                  </div>
                </div>
              </>
            )}

            {currentView === 'month' && (
              <>
                <div style={{ ...styles.card, display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
                  <button onClick={() => setMonthOffset(monthOffset - 1)}
                    style={{ padding: '8px', background: 'transparent', color: '#fafafa', fontSize: '20px' }}>‚Üê</button>
                  <p style={{ fontSize: '20px', fontWeight: 'bold' }}>
                    {new Date(new Date().getFullYear(), new Date().getMonth() + monthOffset, 1)
                      .toLocaleDateString('fr-FR', { month: 'long', year: 'numeric' })}
                  </p>
                  <button onClick={() => setMonthOffset(monthOffset + 1)} disabled={monthOffset >= 0}
                    style={{ padding: '8px', background: 'transparent', color: '#fafafa', fontSize: '20px', opacity: monthOffset >= 0 ? 0.3 : 1 }}>‚Üí</button>
                </div>

                <div style={{ display: 'grid', gridTemplateColumns: 'repeat(7, 1fr)', gap: '4px', marginBottom: '8px' }}>
                  {['Lun', 'Mar', 'Mer', 'Jeu', 'Ven', 'Sam', 'Dim'].map(day => (
                    <div key={day} style={{ textAlign: 'center', fontSize: '12px', fontWeight: 'bold', color: '#71717a', textTransform: 'uppercase', padding: '8px' }}>
                      {day}
                    </div>
                  ))}
                </div>

                <div style={{ display: 'grid', gridTemplateColumns: 'repeat(7, 1fr)', gap: '4px', marginBottom: '16px' }}>
                  {monthDates.map(date => {
                    const status = getDayStatus(date);
                    const dayData = data[date];
                    const dayNum = new Date(date).getDate();
                    const isCurrentMonth = new Date(date).getMonth() === new Date().getMonth() + monthOffset;
                    const statusColors = {
                      complete: { bg: 'rgba(16, 185, 129, 0.1)', border: '#10b981' },
                      partial: { bg: 'rgba(251, 146, 60, 0.1)', border: '#fb923c' },
                      incomplete: { bg: 'rgba(244, 63, 94, 0.1)', border: '#f43f5e' },
                      empty: { bg: '#18181b', border: '#27272a' }
                    };

                    return (
                      <button key={date} onClick={() => { setSelectedDate(date); setCurrentView('today'); }}
                        style={{
                          aspectRatio: '1', borderRadius: '8px', padding: '8px', border: `2px solid ${statusColors[status].border}`,
                          background: statusColors[status].bg, opacity: isCurrentMonth ? 1 : 0.3, textAlign: 'center'
                        }}>
                        <div style={{ fontSize: '16px', fontWeight: 'bold' }}>{dayNum}</div>
                        {dayData?.weight && isCurrentMonth && <div style={{ fontSize: '8px', color: '#a1a1aa', marginTop: '2px' }}>{dayData.weight}</div>}
                      </button>
                    );
                  })}
                </div>

                <div style={styles.card}>
                  <h3 style={{ fontWeight: 'bold', marginBottom: '16px' }}>L√©gende</h3>
                  <div style={{ display: 'flex', flexDirection: 'column', gap: '12px', fontSize: '14px' }}>
                    <div style={{ display: 'flex', alignItems: 'center', gap: '12px' }}>
                      <div style={{ width: '24px', height: '24px', borderRadius: '4px', background: 'rgba(16, 185, 129, 0.1)', border: '2px solid #10b981' }}></div>
                      <span>Vert : Tout fait ‚úì</span>
                    </div>
                    <div style={{ display: 'flex', alignItems: 'center', gap: '12px' }}>
                      <div style={{ width: '24px', height: '24px', borderRadius: '4px', background: 'rgba(251, 146, 60, 0.1)', border: '2px solid #fb923c' }}></div>
                      <span>Orange : Partiel (&gt;60%)</span>
                    </div>
                    <div style={{ display: 'flex', alignItems: 'center', gap: '12px' }}>
                      <div style={{ width: '24px', height: '24px', borderRadius: '4px', background: 'rgba(244, 63, 94, 0.1)', border: '2px solid #f43f5e' }}></div>
                      <span>Rouge : Peu fait</span>
                    </div>
                    <div style={{ display: 'flex', alignItems: 'center', gap: '12px' }}>
                      <div style={{ width: '24px', height: '24px', borderRadius: '4px', background: '#18181b', border: '2px solid #27272a' }}></div>
                      <span>Gris : Pas de donn√©es</span>
                    </div>
                  </div>
                </div>
              </>
            )}

            {currentView === 'progress' && (
              <>
                <div style={styles.card}>
                  <label style={{ fontSize: '14px', fontWeight: '600', color: '#a1a1aa', display: 'block', marginBottom: '12px' }}>
                    Afficher la progression de :
                  </label>
                  <select value={progressMetric} onChange={(e) => setProgressMetric(e.target.value)} style={styles.select}>
                    <option value="weight">Poids (kg)</option>
                    <option value="steps">Nombre de pas</option>
                    <option value="training">S√©ances de training</option>
                    <option value="fasting">Jours de je√ªne par type</option>
                  </select>
                </div>

                {progressData.length > 0 ? (
                  <>
                    <div style={{ display: 'grid', gridTemplateColumns: 'repeat(2, 1fr)', gap: '16px', marginBottom: '16px' }}>
                      <div style={styles.card}>
                        <div style={{ display: 'flex', alignItems: 'center', gap: '8px', color: '#fb923c', marginBottom: '8px' }}>
                          <span style={{ fontSize: '20px' }}>üî•</span>
                          <span style={{ fontSize: '14px', fontWeight: '600' }}>Streak</span>
                        </div>
                        <p style={{ fontSize: '40px', fontWeight: 'black' }}>{streak}</p>
                        <p style={{ fontSize: '12px', color: '#71717a', marginTop: '4px' }}>jours cons√©cutifs</p>
                      </div>

                      {progressMetric === 'weight' && progressData.length >= 2 && (
                        <div style={styles.card}>
                          <div style={{ display: 'flex', alignItems: 'center', gap: '8px', color: '#10b981', marginBottom: '8px' }}>
                            <span style={{ fontSize: '20px' }}>üìâ</span>
                            <span style={{ fontSize: '14px', fontWeight: '600' }}>Perte totale</span>
                          </div>
                          <p style={{ fontSize: '40px', fontWeight: 'black' }}>
                            {(progressData[0].value - progressData[progressData.length - 1].value).toFixed(1)}
                          </p>
                          <p style={{ fontSize: '12px', color: '#71717a', marginTop: '4px' }}>kg perdus</p>
                        </div>
                      )}

                      {progressMetric === 'steps' && progressData.length > 0 && (
                        <div style={styles.card}>
                          <div style={{ display: 'flex', alignItems: 'center', gap: '8px', color: '#3b82f6', marginBottom: '8px' }}>
                            <span style={{ fontSize: '20px' }}>üë£</span>
                            <span style={{ fontSize: '14px', fontWeight: '600' }}>Moyenne</span>
                          </div>
                          <p style={{ fontSize: '40px', fontWeight: 'black' }}>
                            {Math.round(progressData.reduce((sum, d) => sum + d.value, 0) / progressData.length).toLocaleString()}
                          </p>
                          <p style={{ fontSize: '12px', color: '#71717a', marginTop: '4px' }}>pas / jour</p>
                        </div>
                      )}

                      {progressMetric === 'training' && progressData.length > 0 && (
                        <div style={styles.card}>
                          <div style={{ display: 'flex', alignItems: 'center', gap: '8px', color: '#f43f5e', marginBottom: '8px' }}>
                            <span style={{ fontSize: '20px' }}>üí™</span>
                            <span style={{ fontSize: '14px', fontWeight: '600' }}>Total s√©ances</span>
                          </div>
                          <p style={{ fontSize: '40px', fontWeight: 'black' }}>
                            {Object.values(data).filter(d => d.training).length}
                          </p>
                          <p style={{ fontSize: '12px', color: '#71717a', marginTop: '4px' }}>s√©ances effectu√©es</p>
                        </div>
                      )}

                      {progressMetric === 'fasting' && progressData.length > 0 && (
                        <div style={styles.card}>
                          <div style={{ display: 'flex', alignItems: 'center', gap: '8px', color: '#a855f7', marginBottom: '8px' }}>
                            <span style={{ fontSize: '20px' }}>‚è∞</span>
                            <span style={{ fontSize: '14px', fontWeight: '600' }}>Total je√ªnes</span>
                          </div>
                          <p style={{ fontSize: '40px', fontWeight: 'black' }}>
                            {progressData.reduce((sum, d) => sum + d.value, 0)}
                          </p>
                          <p style={{ fontSize: '12px', color: '#71717a', marginTop: '4px' }}>jours de je√ªne</p>
                        </div>
                      )}
                    </div>

                    <div style={styles.card}>
                      <h2 style={{ fontSize: '20px', fontWeight: 'bold', marginBottom: '24px' }}>
                        {progressMetric === 'weight' && '√âvolution du poids'}
                        {progressMetric === 'steps' && 'Nombre de pas quotidiens'}
                        {progressMetric === 'training' && 'S√©ances par p√©riode'}
                        {progressMetric === 'fasting' && 'Distribution des je√ªnes'}
                      </h2>
                      <canvas ref={chartRef} style={{ maxHeight: '300px' }}></canvas>
                    </div>
                  </>
                ) : (
                  <div style={{ ...styles.card, textAlign: 'center', padding: '48px' }}>
                    <div style={{ fontSize: '64px', marginBottom: '16px' }}>üìä</div>
                    <p style={{ color: '#a1a1aa' }}>Aucune donn√©e pour ce metric encore</p>
                    <p style={{ color: '#71717a', fontSize: '14px', marginTop: '8px' }}>Continue √† tracker tes progr√®s !</p>
                  </div>
                )}
              </>
            )}

            {currentView === 'history' && (
              <>
                <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: '16px' }}>
                  <h2 style={{ fontSize: '24px', fontWeight: 'bold' }}>Historique</h2>
                  <button onClick={exportData} style={{ padding: '8px 16px', borderRadius: '8px', background: '#10b981', color: '#09090b', fontWeight: '600' }}>
                    üì• Export CSV
                  </button>
                </div>
                {Object.entries(data).sort(([a], [b]) => new Date(b) - new Date(a)).map(([date, d]) => (
                  <button key={date} onClick={() => { setSelectedDate(date); setCurrentView('today'); }}
                    style={{ ...styles.card, cursor: 'pointer', textAlign: 'left', width: '100%' }}>
                    <p style={{ fontWeight: 'bold', fontSize: '18px' }}>
                      {new Date(date).toLocaleDateString('fr-FR', { weekday: 'long', day: 'numeric', month: 'long' })}
                    </p>
                    <div style={{ display: 'flex', gap: '16px', marginTop: '8px', fontSize: '14px', color: '#a1a1aa', flexWrap: 'wrap' }}>
                      {d.weight && <span>‚öñÔ∏è {d.weight}kg</span>}
                      {d.training && <span>üí™ {d.training.split('(')[0]}</span>}
                      {d.steps && <span>üë£ {d.steps}</span>}
                      {d.fasting && <span>‚è∞ {d.fasting}</span>}
                      {d.hydration && <span>üíß</span>}
                      {d.mood?.length > 0 && <span>{d.mood.join(' ')}</span>}
                    </div>
                    {d.comments && <p style={{ fontSize: '12px', color: '#71717a', marginTop: '8px', fontStyle: 'italic' }}>"{d.comments.substring(0, 60)}..."</p>}
                  </button>
                ))}
                {Object.keys(data).length === 0 && (
                  <div style={{ ...styles.card, textAlign: 'center', padding: '48px' }}>
                    <div style={{ fontSize: '64px', marginBottom: '16px' }}>üìÖ</div>
                    <p style={{ color: '#a1a1aa' }}>Aucune donn√©e encore</p>
                    <p style={{ color: '#71717a', fontSize: '14px', marginTop: '8px' }}>Commence √† tracker d√®s aujourd'hui !</p>
                  </div>
                )}
              </>
            )}

            <div style={{ ...styles.card, textAlign: 'center' }}>
              <p style={{ fontSize: '18px', fontWeight: 'bold', color: '#10b981', marginBottom: '8px' }}>
                {Object.keys(data).length} jours track√©s
              </p>
              <p style={{ color: '#71717a', fontSize: '14px' }}>Donn√©es sauvegard√©es localement</p>
            </div>
          </div>
        </div>
      );
    };

    ReactDOM.render(<App />, document.getElementById('root'));
  </script>
</body>
</html>
